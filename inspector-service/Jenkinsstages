/*
 * Build `inspector-service`
 */
stage('Init environment variables for inspector-service') {
    when {
        expression {
            return !sh(returnStatus: true, script: "git diff --name-only $MY_GIT_PREVIOUS_SUCCESSFUL_COMMIT|egrep -q '^inspector-service'")
        }
    }
    steps {
        echo 'Init environment variables for inspector-service'
    }
}

stage('Install and building inspector-service') {
    when {
        expression {
            return !sh(returnStatus: true, script: "git diff --name-only $MY_GIT_PREVIOUS_SUCCESSFUL_COMMIT|egrep -q '^inspector-service'")
        }
    }
    steps {
        script {
            dir ('inspector-service') {
                sh 'npm ci'
                sh 'npm build'
            }
        }
    }
}

stage('Testing inspector-service') {
    when {
        expression {
            return false && !sh(returnStatus: true, script: "git diff --name-only $MY_GIT_PREVIOUS_SUCCESSFUL_COMMIT|egrep -q '^inspector-service'")
        }
    }
    steps {
        script {
            dir ('inspector-service') {
                sh 'npm test'
            }
        }
    }
}

stage('Build docker image for inspector-service') {
    when {
        expression {
            return false && !sh(returnStatus: true, script: "git diff --name-only $MY_GIT_PREVIOUS_SUCCESSFUL_COMMIT|egrep -q '^inspector-service'")
        }
    }
    steps {
        script {
            dir ('inspector-service') {
                sh 'docker build .'
            }
        }
    }
}

stage('Publish artifacts for inspector-service') {
    when {
        expression {
            return false && !sh(returnStatus: true, script: "git diff --name-only $MY_GIT_PREVIOUS_SUCCESSFUL_COMMIT|egrep -q '^inspector-service'")
        }
    }
    steps {
        script {
            dir ('inspector-service') {
                sh 'docker push'
            }
        }
    }
}